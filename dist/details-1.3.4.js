/*!
  GeoPortal Genie by Stephen Lead
  GeoPortalGenie.com
*/
;if(!this.gpGenie||typeof this.gpGenie!=="object"){this.gpGenie={}}gpGenie.DetailsModel=Backbone.Model.extend({initialize:function(a){_.bindAll(this,"fetchDetails","handleDetails")},fetchDetails:function(c){var b="rest/document/"+c;var a=$.ajax({url:configOptions.proxy,data:{requrl:configOptions.geoportalServer+b},context:this,success:function(d){this.handleDetails(d)},error:function(d){var e="error with Details query";alert(e)}})},handleDetails:function(e){try{$("#modalContent").html(null);$("#modalTitle").html(null);this.detailsData={title:"Unable to retrieve title",summary:"Unable to retrieve summary",agency:"Unable to retrieve agency",contact:"Unable to retrieve contact details"};var b=$.xml2json(e);if(b.identificationInfo!==undefined){try{this.detailsData.title=b.identificationInfo.MD_DataIdentification.citation.CI_Citation.title.CharacterString}catch(c){console.log("unable to retrieve title")}try{this.detailsData.summary=b.identificationInfo.MD_DataIdentification["abstract"].CharacterString}catch(c){console.log("unable to retrieve summary")}try{if(b.identificationInfo.MD_DataIdentification.pointOfContact!==undefined){var a=b.identificationInfo.MD_DataIdentification.pointOfContact;if(a.CI_ResponsibleParty!==undefined){this.detailsData.agency=a.CI_ResponsibleParty.organisationName.CharacterString}else{if(a.length>0){this.detailsData.agency=a[0].CI_ResponsibleParty.organisationName.CharacterString;for(var d=1;d<a.length;d++){this.detailsData.agency=this.detailsData.agency+", "+a[d].CI_ResponsibleParty.organisationName.CharacterString}}}}}catch(c){console.log("unable to retrieve agency")}try{if(b.contact.CI_ResponsibleParty.contactInfo.CI_Contact.address.CI_Address!==undefined){var f=b.contact.CI_ResponsibleParty.contactInfo.CI_Contact.address.CI_Address;if(f.electronicMailAddress!==undefined){var a=f.electronicMailAddress.CharacterString;this.detailsData.contact="<a href='mailto:"+a+"'>"+a+"</a>"}else{if(f.deliveryPoint!==undefined&&f.deliveryPoint.CharacterString!==undefined){this.detailsData.contact=f.deliveryPoint.CharacterString}if(f.city!==undefined&&f.city.CharacterString!==undefined){if(this.detailsData.contact.length>0){this.detailsData.contact=this.detailsData.contact+", "+f.city.CharacterString}else{this.detailsData.contact=f.city.CharacterString}}if(f.country!==undefined&&f.country.CharacterString!==undefined){if(this.detailsData.contact.length>0){this.detailsData.contact=this.detailsData.contact+", "+f.country.CharacterString}else{this.detailsData.contact=f.country.CharacterString}}if(f.postalCode!==undefined&&f.postalCode.CharacterString!==undefined){if(this.detailsData.contact.length>0){this.detailsData.contact=this.detailsData.contact+", "+f.postalCode.CharacterString}else{this.detailsData.contact=f.postalCode.CharacterString}}}}}catch(c){console.log("unable to retrieve contact details")}}else{if(b.idinfo!==undefined){try{this.detailsData.title=b.idinfo.citation.citeinfo.title}catch(c){console.log("unable to retrieve title")}try{this.detailsData.summary=b.idinfo.descript["abstract"]}catch(c){console.log("unable to retrieve summary")}try{if(b.metainfo!==undefined){if(b.metainfo.metc.cntinfo!==undefined){if(b.metainfo.metc.cntinfo.cntperp!==undefined){if(b.metainfo.metc.cntinfo.cntperp.cntorg!==undefined){this.detailsData.agency=b.metainfo.metc.cntinfo.cntperp.cntorg}else{if(b.metainfo.metc.cntinfo.cntperp.cntper!==undefined){this.detailsData.agency=b.metainfo.metc.cntinfo.cntperp.cntper}}}else{if(b.metainfo.metc.cntinfo.cntorgp!==undefined){if(b.metainfo.metc.cntinfo.cntorgp.cntorg!==undefined){this.detailsData.agency=b.metainfo.metc.cntinfo.cntorgp.cntorg}}}}}}catch(c){console.log("unable to retrieve agency")}try{if(b.metainfo.metc.cntinfo!==undefined){if(b.metainfo.metc.cntinfo.cntaddr!==undefined){if(b.metainfo.metc.cntinfo.cntaddr.address!==undefined){this.detailsData.contact=b.metainfo.metc.cntinfo.cntaddr.address}if(b.metainfo.metc.cntinfo.cntaddr.city!==undefined){if(this.detailsData.contact.length>0){this.detailsData.contact=this.detailsData.contact+", "+b.metainfo.metc.cntinfo.cntaddr.city}else{this.detailsData.contact=b.metainfo.metc.cntinfo.cntaddr.city}}if(b.metainfo.metc.cntinfo.cntaddr.state!==undefined){if(this.detailsData.contact.length>0){this.detailsData.contact=this.detailsData.contact+", "+b.metainfo.metc.cntinfo.cntaddr.state}else{this.detailsData.contact=b.metainfo.metc.cntinfo.cntaddr.state}}}}}catch(c){console.log("Unable to retrieve contact details")}}else{if(b.Description!==undefined){try{this.detailsData.title=b.Description.title}catch(c){console.log("unable to retrieve title")}try{this.detailsData.summary=b.Description.description}catch(c){console.log("unable to retrieve summary")}}else{$("#modalContent").html("Sorry, there was a problem retrieving the details for this record")}}}this.trigger("detailsReturned",this.detailsData,this)}catch(c){alert("Sorry, there was an error loading the stylesheet. Please contact your GeoPortal Genie administrator")}$(".btnDetailsLink").button("reset")}});gpGenie.DetailsView=Backbone.View.extend({initialize:function(a){_.bindAll(this,"onDetailsReturned");this.detailsModel=a.detailsModel;this.detailsModel.on("detailsReturned",this.onDetailsReturned);this.detailsTemplate=ich[a.detailsTemplate];$(this.options.detailsContainer).append(this.el)},className:"details",onDetailsReturned:function(b){if(b!==undefined){var a=this.render();$(a.options.detailsContainer).modal()}},render:function(){var a=_.template($(this.options.detailsTemplate).html(),this.options.detailsModel.detailsData);this.$el.html(a);return this}});